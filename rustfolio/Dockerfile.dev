FROM rust:1.85

# Même chemin que dans docker-compose
WORKDIR /app/rustfolio

# Outils dev nécessaires dans le conteneur
RUN /usr/local/cargo/bin/cargo install sqlx-cli --locked --no-default-features --features sqlite \
 && /usr/local/cargo/bin/cargo install cargo-watch --locked

# Entrypoint: prépare SQLite (crée le dossier parent), database create, migrations, puis exec la commande
COPY docker-entrypoint.sh /usr/local/bin/docker-entrypoint.sh
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

ENTRYPOINT ["/usr/local/bin/docker-entrypoint.sh"]
